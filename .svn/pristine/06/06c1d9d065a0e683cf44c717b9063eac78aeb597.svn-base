package com.jtmproject.actions;

import java.io.File;
import java.util.List;

import com.jtmproject.gui.AnimationSearching;
import com.jtmproject.gui.ButtonSearch;
import com.jtmproject.gui.MainWindowJFrame;
import com.jtmproject.gui.MessageDialog;
import com.jtmproject.user.MessagesUser;

/**
 * this class manages the jtm downloads and opens 
 * @author Javier Tejedor
 */
public class CoreDownloadOpenJtm implements Runnable{

	private List<String> listUrlsJTM;
	private DownloadJTM downloadJTM;
	private boolean run;
	
	/**
	 * constructor
	 * @param jFrame
	 * @param listUrlsJTM
	 */
	public CoreDownloadOpenJtm(List<String> listUrlsJTM) {
		this.listUrlsJTM = listUrlsJTM;
		this.run = true;
		new Thread(this).start();
	}
	
	/**
	 * this method stops all the actions
	 */
	public void stopActions(){
		if(downloadJTM != null){
			downloadJTM.stopActions();
		}
		run = false;
	}
	
	@Override
	public void run() {
		downloadJTM = new DownloadJTM(listUrlsJTM);
		OpenJTM op = new OpenJTM();
		int size = downloadJTM.getPathDownloadJtm().size();
		int contFails = 0;
		int i = 0;
		
		while(i < size && run){
			String path = downloadJTM.getPathDownloadJtm().get(i);
			if(new AnalizeXSD().analizeJtmWithXsd(new File(path))){
				if(!op.open(path)){
					contFails++;
				}
			}
			i++;
		}
		
		if(contFails > 0){
			MessageDialog.messageDialogError(MainWindowJFrame.getjFrame(), MessagesUser.getMU().getErrorOpenFile());
		}
		
		AnimationSearching.setAnimationSearching(false);
		ButtonSearch.setStateButton(ButtonSearch.STATE_CAN_SEARCH);
	}
}
